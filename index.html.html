<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElectroHub | Orders & Returns</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#0f172a',
                            primary: '#3b82f6',
                            accent: '#06b6d4',
                            surface: '#1e293b',
                            card: '#334155',
                            success: '#10b981',
                            warning: '#f59e0b',
                            danger: '#ef4444',
                            invGreen: '#d1e7dd',
                            invText: '#198754',
                            invBorder: '#2f5d28'
                        }
                    },
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                        tech: ['Orbitron', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .tech-gradient { background: linear-gradient(90deg, #3b82f6 0%, #06b6d4 100%); }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(6, 182, 212, 0.2); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast { animation: slideIn 0.5s ease forwards; }
        .dash-card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; }
        .indian-rupee { font-family: sans-serif; }
        .timeline-item { border-left: 2px solid #334155; padding-left: 20px; padding-bottom: 20px; position: relative; }
        .timeline-item::before { content: ''; width: 12px; height: 12px; background: #3b82f6; border-radius: 50%; position: absolute; left: -7px; top: 0; }
        .timeline-item.active::before { background: #10b981; box-shadow: 0 0 10px #10b981; }
        
        @media print {
            body * { visibility: hidden; }
            #invoice-view, #invoice-view * { visibility: visible; }
            #invoice-view { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; padding: 0; background: white; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="bg-brand-surface border-b border-gray-700 sticky top-0 z-50 no-print">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="router('home')">
                <i class="fa-solid fa-microchip text-brand-accent text-3xl"></i>
                <h1 class="text-2xl font-tech font-bold text-white tracking-wider">ELECTRO<span class="text-brand-primary">HUB</span></h1>
            </div>
            
            <div class="flex items-center gap-6">
                <div class="hidden md:flex items-center gap-6">
                    <button onclick="router('home')" class="hover:text-brand-accent transition">Home</button>
                    <button onclick="filterCategory('microcontrollers')" class="hover:text-brand-accent transition">Micros</button>
                    <button onclick="filterCategory('components')" class="hover:text-brand-accent transition">Components</button>
                    <button onclick="router('track')" class="hover:text-brand-accent transition text-brand-warning"><i class="fa-solid fa-truck-fast"></i> Track Order</button>
                </div>
                
                <div class="flex items-center gap-4">
                    <div id="auth-section" class="flex items-center gap-3"></div>
                    <div class="relative cursor-pointer ml-2" onclick="router('cart')">
                        <i class="fa-solid fa-cart-shopping text-xl hover:text-brand-accent transition"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="app" class="flex-grow container mx-auto px-4 py-8"></main>

    <!-- Footer -->
    <footer class="bg-brand-surface border-t border-gray-700 mt-auto no-print">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="font-tech text-xl mb-4 text-white">ElectroHub India</h3>
                    <p class="text-gray-400 text-sm">Made in India. Official distributors for Arduino & Espressif. GST Registered.</p>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-4 text-white">Quick Links</h3>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li><a href="#" onclick="router('home')" class="hover:text-brand-accent">Shop All</a></li>
                        <li><a href="#" onclick="router('track')" class="hover:text-brand-accent">Track Order</a></li>
                        <li><a href="#" onclick="router('login')" class="hover:text-brand-accent text-brand-primary">Admin Login</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-4 text-white">Logistics Partners</h3>
                    <div class="flex gap-4 text-2xl text-gray-400">
                        <i class="fa-solid fa-truck-fast hover:text-white" title="BlueDart"></i>
                        <i class="fa-solid fa-box hover:text-white" title="Delhivery"></i>
                    </div>
                </div>
            </div>
            <div class="text-center text-gray-600 text-xs mt-8">&copy; 2026 ElectroHub. All rights reserved.</div>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

    <script>
        // ========================================================
        // ⚠️ PASTE YOUR GOOGLE SCRIPT URL HERE
        // ========================================================
        const GOOGLE_SCRIPT_URL = 'PASTE_YOUR_GOOGLE_SCRIPT_URL_HERE'; 
        
        // --- CONSTANTS ---
        const GST_RATE = 0.18; 
        const SHIPPING_FEE = 50.00;
        const FREE_SHIPPING_THRESHOLD = 499.00;
        const RETURN_WINDOW_DAYS = 5; // 5 Day Return Policy

        // --- INITIAL DATA ---
        const defaultProducts = [
            { id: 1, name: "Arduino Uno R3", category: "microcontrollers", price: 650.00, image: "https://upload.wikimedia.org/wikipedia/commons/7/74/Arduino_Uno_-_R3.jpg", description: "The classic Arduino board. Perfect for beginners. ATmega328P based." },
            { id: 2, name: "ESP32 Dev Module", category: "microcontrollers", price: 550.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/ESP32_Espressif_ESP-WROOM-32_Dev_Board.jpg/800px-ESP32_Espressif_ESP-WROOM-32_Dev_Board.jpg", description: "Dual-core Wi-Fi & Bluetooth MCU. High performance." },
            { id: 3, name: "Arduino Nano V3", category: "microcontrollers", price: 280.00, image: "https://thumbs.dreamstime.com/b/arduino-nano-v-electronic-device-31620023.jpg", description: "Compact board, breadboard friendly. Mini-USB interface." },
            { id: 4, name: "Raspberry Pi Pico", category: "microcontrollers", price: 450.00, image: "https://www.raspberrypi.com/documentation/microcontrollers/images/pico-pinout.svg", description: "Low-cost, high-performance microcontroller board with RP2040 chip." },
            { id: 13, name: "Raspberry Pi 4 Model B (4GB)", category: "microcontrollers", price: 4800.00, image: "https://upload.wikimedia.org/wikipedia/commons/f/f1/Raspberry_Pi_4_Model_B_-_Side.jpg", description: "Desktop class performance. 4GB RAM, Quad-core CPU, Dual Display support." },
            { id: 14, name: "NodeMCU ESP8266", category: "microcontrollers", price: 320.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/NodeMCU_v1.0_-_Lua_based_ESP8266_development_kit.jpg/800px-NodeMCU_v1.0_-_Lua_based_ESP8266_development_kit.jpg", description: "Low cost Wi-Fi MCU. Great for basic IoT projects." },
            { id: 5, name: "Ultrasonic Sensor HC-SR04", category: "sensors", price: 85.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/HC-SR04.jpg/800px-HC-SR04.jpg", description: "Provides 2cm - 400cm non-contact measurement." },
            { id: 6, name: "DHT11 Temp & Humidity", category: "sensors", price: 90.00, image: "https://upload.wikimedia.org/wikipedia/commons/8/87/DHT11_Humidity_Temperature_Sensor.jpg", description: "Basic digital temperature and humidity sensor." },
            { id: 18, name: "IR Proximity Sensor", category: "sensors", price: 35.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/IR_Sensor_Module.jpg/640px-IR_Sensor_Module.jpg", description: "Infrared obstacle avoidance sensor module for Arduino." },
            { id: 7, name: "1N4007 Diode Pack (50pcs)", category: "components", price: 40.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Diode_1N4001.jpg/800px-Diode_1N4001.jpg", description: "Standard recovery rectifier diodes." },
            { id: 8, name: "Resistor Kit (600pcs)", category: "components", price: 220.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Resistor_strip.jpg/800px-Resistor_strip.jpg", description: "1/4W Metal Film Resistors. 30 different values." },
            { id: 9, name: "LED Assortment Box", category: "components", price: 180.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/5_LEDs.jpg/800px-5_LEDs.jpg", description: "Red, Green, Yellow, Blue, White LEDs (5mm)." },
            { id: 10, name: "Breadboard 830 Point", category: "components", price: 120.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Solderless_Breadboard.jpg/800px-Solderless_Breadboard.jpg", description: "Solderless breadboard for prototyping." },
            { id: 12, name: "Jumper Wires (M-M, M-F, F-F)", category: "components", price: 150.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Jumper_wires_on_breadboard.jpg/800px-Jumper_wires_on_breadboard.jpg", description: "120pcs multicolored Dupont wire cables." },
            { id: 15, name: "16x2 LCD Display (I2C)", category: "components", price: 220.00, image: "https://upload.wikimedia.org/wikipedia/commons/3/3d/16x2_LCD_Module_Backlight.jpg", description: "Blue backlight LCD with I2C adapter soldered for easy connection." },
            { id: 17, name: "5V Relay Module 1-CH", category: "components", price: 65.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Relay_Module.jpg/640px-Relay_Module.jpg", description: "Control high voltage devices with Arduino. 5V logic." },
            { id: 19, name: "9V Battery + Snap Connector", category: "components", price: 30.00, image: "https://upload.wikimedia.org/wikipedia/commons/f/fc/9V_battery_%28 Energizer%29.jpg", description: "Standard 9V HW battery for powering Arduino projects." },
            { id: 20, name: "Digital Multimeter DT830D", category: "components", price: 350.00, image: "https://upload.wikimedia.org/wikipedia/commons/2/23/Digital_Multimeter_DT-830B.jpg", description: "Essential tool for electronics. Measures Voltage, Current, Resistance." },
            { id: 11, name: "SG90 Micro Servo", category: "motors", price: 95.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Servo_Motor_SG90.jpg/640px-Servo_Motor_SG90.jpg", description: "Tiny and lightweight with high output power." },
            { id: 16, name: "L298N Motor Driver", category: "motors", price: 140.00, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/75/L298N_Motor_Driver_Module.jpg/640px-L298N_Motor_Driver_Module.jpg", description: "Dual H-Bridge motor driver for driving DC motors and Steppers." }
        ];

        // --- STATE MANAGEMENT ---
        let products = JSON.parse(localStorage.getItem('electroHubProducts')) || [];
        if (products.length === 0) {
            products = defaultProducts;
            localStorage.setItem('electroHubProducts', JSON.stringify(products));
        }

        let adminCreds = JSON.parse(localStorage.getItem('electroHubAdminCreds'));
        if (!adminCreds) {
            adminCreds = { email: 'admin@electrohub.com', password: 'admin123' };
            localStorage.setItem('electroHubAdminCreds', JSON.stringify(adminCreds));
        }

        let cart = JSON.parse(localStorage.getItem('electroHubCart')) || [];
        let currentUser = JSON.parse(localStorage.getItem('electroHubCurrentUser')) || null;
        let registeredUsers = JSON.parse(localStorage.getItem('electroHubUsers')) || [];
        let orders = JSON.parse(localStorage.getItem('electroHubOrders')) || [];
        let editingProductId = null;

        // --- FUNCTIONS ---
        const formatRupee = (amount) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 2 }).format(amount);
        const saveProducts = () => localStorage.setItem('electroHubProducts', JSON.stringify(products));
        const saveCart = () => { localStorage.setItem('electroHubCart', JSON.stringify(cart)); updateCartCount(); };
        const saveOrders = () => localStorage.setItem('electroHubOrders', JSON.stringify(orders));
        const updateCartCount = () => document.getElementById('cart-count').innerText = cart.reduce((acc, item) => acc + item.qty, 0);

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const existing = cart.find(i => i.id === id);
            existing ? existing.qty++ : cart.push({ ...product, qty: 1 });
            saveCart();
            showToast(`Added ${product.name}`, 'success');
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            saveCart();
            router('cart');
        }

        function updateQty(id, change) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.qty += change;
                if (item.qty <= 0) removeFromCart(id);
                else { saveCart(); router('cart'); }
            }
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'success' ? 'bg-brand-success' : 'bg-brand-danger'} text-white px-6 py-3 rounded shadow-lg font-bold flex items-center gap-2`;
            toast.innerHTML = `<i class="fa-solid ${type === 'success' ? 'fa-check' : 'fa-triangle-exclamation'}"></i> ${message}`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // --- AUTH ---
        function updateAuthUI() {
            const authSection = document.getElementById('auth-section');
            if (currentUser) {
                const adminBadge = currentUser.isAdmin ? '<span class="bg-brand-warning text-brand-dark text-[10px] font-bold px-1 rounded ml-1">ADMIN</span>' : '';
                const dashboardBtn = currentUser.isAdmin ? `<button onclick="router('admin')" class="text-xs border border-brand-accent text-brand-accent px-2 py-1 rounded hover:bg-brand-accent hover:text-brand-dark transition mr-2">Dashboard</button>` : '';
                const myOrdersBtn = !currentUser.isAdmin ? `<button onclick="router('my-orders')" class="text-xs border border-brand-success text-brand-success px-2 py-1 rounded hover:bg-brand-success hover:text-brand-dark transition mr-2">My Orders</button>` : '';
                
                authSection.innerHTML = `
                    <div class="hidden md:flex flex-col text-right mr-2"><span class="text-xs text-gray-400">Namaste,</span><span class="text-sm font-bold text-white">${currentUser.name} ${adminBadge}</span></div>
                    ${dashboardBtn}
                    ${myOrdersBtn}
                    <button onclick="logout()" class="text-sm border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-500 hover:text-white transition">Logout</button>
                `;
            } else {
                authSection.innerHTML = `<button onclick="router('login')" class="text-sm text-gray-300 hover:text-white mr-2">Login</button><button onclick="router('signup')" class="bg-brand-primary text-sm text-white px-4 py-2 rounded-full hover:bg-blue-600 transition shadow-lg shadow-blue-500/30">Sign Up</button>`;
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-pass').value;
            if (email === adminCreds.email && password === adminCreds.password) {
                currentUser = { name: "Admin", email: email, isAdmin: true };
                localStorage.setItem('electroHubCurrentUser', JSON.stringify(currentUser));
                showToast("Admin Dashboard Access Granted", 'success');
                updateAuthUI();
                router('admin');
            } else {
                const user = registeredUsers.find(u => u.email === email && u.password === password);
                if (user) {
                    currentUser = user;
                    localStorage.setItem('electroHubCurrentUser', JSON.stringify(currentUser));
                    showToast(`Welcome back, ${user.name}!`, 'success');
                    updateAuthUI();
                    router('home');
                } else { alert("Invalid Email or Password"); }
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-pass').value;
            if (registeredUsers.find(u => u.email === email)) {
                alert("Account already exists!"); return;
            }
            const newUser = { name: name, email: email, password: password, isAdmin: false };
            registeredUsers.push(newUser);
            localStorage.setItem('electroHubUsers', JSON.stringify(registeredUsers));
            currentUser = newUser;
            localStorage.setItem('electroHubCurrentUser', JSON.stringify(currentUser));
            showToast("Account Created Successfully!", 'success');
            updateAuthUI();
            router('home');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('electroHubCurrentUser');
            showToast("Logged out successfully", 'success');
            updateAuthUI();
            router('home');
        }

        function updateAdminSettings(e) {
            e.preventDefault();
            const newEmail = document.getElementById('admin-new-email').value;
            const currentPass = document.getElementById('admin-curr-pass').value;
            const newPass = document.getElementById('admin-new-pass').value;
            if (currentPass !== adminCreds.password) { showToast("Incorrect Current Password!", 'danger'); return; }
            adminCreds = { email: newEmail, password: newPass };
            localStorage.setItem('electroHubAdminCreds', JSON.stringify(adminCreds));
            showToast("Credentials Updated! Please Re-login.", 'success');
            logout();
        }

        // --- CHECKOUT & CALCULATIONS ---

        function handleCheckout(e) {
            e.preventDefault();
            
            const subTotal = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
            const shipping = subTotal >= FREE_SHIPPING_THRESHOLD ? 0 : SHIPPING_FEE;
            const grandTotal = subTotal + shipping;

            const name = document.getElementById('checkout-name').value;
            const email = document.getElementById('checkout-email').value;
            const phone = document.getElementById('checkout-phone').value;
            const city = document.getElementById('checkout-city').value;
            const address = document.getElementById('checkout-address').value;
            
            const orderItems = cart.map(item => ({ name: item.name, price: item.price, qty: item.qty }));
            
            const newOrder = {
                id: 'ORD-' + Math.floor(1000 + Math.random() * 9000),
                customer: name,
                email: email,
                phone: phone,
                subTotal: subTotal,
                shipping: shipping,
                total: grandTotal,
                date: new Date().toISOString().split('T')[0],
                status: 'Processing',
                courier: 'Pending',
                trackingId: '-',
                city: city,
                address: address,
                items: orderItems
            };
            
            orders.unshift(newOrder); 
            saveOrders();
            
            if(GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL.startsWith('https://script.google.com')) {
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newOrder)
                }).catch(e => console.log("Sheet Error", e));
            }

            cart = [];
            saveCart();
            alert(`Order Placed Successfully! Your Order ID is ${newOrder.id}`);
            // If logged in, go to my orders, else go to track
            if (currentUser && !currentUser.isAdmin) {
                router('my-orders');
            } else {
                router('track');
            }
        }

        // --- RETURNS & INVOICE ---

        function checkReturnEligibility(orderDateStr) {
            const orderDate = new Date(orderDateStr);
            const today = new Date();
            const diffTime = Math.abs(today - orderDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays <= RETURN_WINDOW_DAYS;
        }

        function requestReturn(orderId) {
            const order = orders.find(o => o.id === orderId);
            
            if(!checkReturnEligibility(order.date)) {
                alert("Return period expired (5 Days).");
                return;
            }

            const reason = prompt("Please tell us the reason for returning this item:");
            if(reason) {
                if(order) {
                    order.status = "Return Requested";
                    order.returnReason = reason;
                    saveOrders();
                    showToast("Return Requested Successfully", 'success');
                    // Refresh current view
                    const currentView = document.getElementById('track-id') ? 'track' : 'my-orders';
                    if (currentView === 'track') document.getElementById('track-form').dispatchEvent(new Event('submit'));
                    else router('my-orders');
                }
            }
        }

        function approveReturn(orderId) {
            if(confirm("Approve return and initiate refund?")) {
                const order = orders.find(o => o.id === orderId);
                if(order) {
                    order.status = "Returned";
                    saveOrders();
                    showToast("Return Approved. Refund Initiated.", 'success');
                    router('admin');
                }
            }
        }

        function rejectReturn(orderId) {
            if(confirm("Reject this return request?")) {
                const order = orders.find(o => o.id === orderId);
                if(order) {
                    order.status = "Delivered"; 
                    delete order.returnReason;
                    saveOrders();
                    showToast("Return Rejected", 'warning');
                    router('admin');
                }
            }
        }

        function generateInvoice(orderId) {
            const order = orders.find(o => o.id === orderId);
            if(!order) return;
            const items = order.items || [{name: 'Components', qty: 1, price: order.total}];
            
            // Tax Breakdown Calculation
            const inclusiveTotal = order.subTotal;
            const baseAmount = inclusiveTotal / 1.18;
            const totalTax = inclusiveTotal - baseAmount;
            const cgst = totalTax / 2;
            const sgst = totalTax / 2;
            
            const orderDate = new Date(order.date);
            const dueDateObj = new Date(orderDate);
            dueDateObj.setDate(orderDate.getDate() + 15);
            const dueDate = dueDateObj.toISOString().split('T')[0];

            const invoiceHTML = `
                <div id="invoice-view" class="bg-white text-black p-8 md:p-16 max-w-4xl mx-auto rounded shadow-xl mt-4 font-sans border border-gray-200">
                    <div class="bg-[#d1e7dd] text-center py-3 mb-6"><h1 class="text-3xl font-bold text-black tracking-widest uppercase">ElectroHub</h1></div>
                    <div class="text-center mb-10 border-b-2 border-[#2f5d28] pb-4"><h2 class="text-4xl md:text-5xl font-bold text-[#2f5d28] tracking-[0.2em] uppercase font-serif">Invoice Bill Sheet</h2></div>
                    <div class="flex flex-col md:flex-row justify-between mb-10 gap-8">
                        <div class="w-full md:w-1/2">
                            <h3 class="font-bold border-b border-gray-400 mb-3 pb-1 text-lg">Invoice To:</h3>
                            <div class="grid grid-cols-[140px_1fr] gap-y-2 text-sm">
                                <span class="font-bold">Customer Name:</span> <span class="uppercase">${order.customer}</span>
                                <span class="font-bold">Address:</span> <span>${order.address || 'N/A'}</span>
                                <span class="font-bold">City:</span> <span>${order.city}, India</span>
                                <span class="font-bold">Email:</span> <span>${order.email || 'N/A'}</span>
                            </div>
                        </div>
                        <div class="w-full md:w-1/3">
                            <h3 class="font-bold border-b border-gray-400 mb-3 pb-1 text-lg">Details</h3>
                            <div class="grid grid-cols-[120px_1fr] gap-y-2 text-sm">
                                <span class="font-bold">Invoice No:</span> <span>INV-${order.id.replace('ORD-', '2026-')}</span>
                                <span class="font-bold">Date:</span> <span>${order.date}</span>
                                <span class="font-bold">Due Date:</span> <span>${dueDate}</span>
                            </div>
                        </div>
                    </div>
                    <table class="w-full mb-8 text-sm border-collapse">
                        <thead class="bg-[#d1e7dd]">
                            <tr>
                                <th class="py-3 px-4 text-left font-bold text-black uppercase text-xs">HSN Code</th>
                                <th class="py-3 px-4 text-left font-bold text-black uppercase text-xs">Description</th>
                                <th class="py-3 px-4 text-center font-bold text-black uppercase text-xs">Qty</th>
                                <th class="py-3 px-4 text-right font-bold text-black uppercase text-xs">Unit Price</th>
                                <th class="py-3 px-4 text-right font-bold text-black uppercase text-xs">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${items.map((item, index) => `
                                <tr class="border-b border-gray-100">
                                    <td class="py-3 px-4 text-gray-700 font-mono">854231</td>
                                    <td class="py-3 px-4">${item.name}</td>
                                    <td class="py-3 px-4 text-center">${item.qty}</td>
                                    <td class="py-3 px-4 text-right">${formatRupee(item.price)}</td>
                                    <td class="py-3 px-4 text-right">${formatRupee(item.price * item.qty)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="flex flex-col md:flex-row justify-between items-start mb-10 gap-8">
                        <div class="w-full md:w-1/2">
                            <h3 class="font-bold text-sm mb-2">Terms:</h3>
                            <div class="border border-gray-300 p-4 text-sm h-full bg-gray-50"><p>1. All disputes subject to Bangalore Jurisdiction.</p><p>2. E. & O.E.</p></div>
                        </div>
                        <div class="w-full md:w-1/3 text-sm">
                            <div class="flex justify-between mb-2"><span>Taxable Value:</span> <span class="font-bold">${formatRupee(baseAmount)}</span></div>
                            <div class="flex justify-between mb-2"><span>CGST (9%):</span> <span>${formatRupee(cgst)}</span></div>
                            <div class="flex justify-between mb-2 border-b border-gray-300 pb-2"><span>SGST (9%):</span> <span>${formatRupee(sgst)}</span></div>
                            <div class="flex justify-between mb-2 pt-2"><span>Subtotal:</span> <span class="font-bold">${formatRupee(inclusiveTotal)}</span></div>
                            <div class="flex justify-between mb-2"><span>Shipping:</span> <span>${formatRupee(order.shipping || 0)}</span></div>
                            <div class="flex justify-between mt-3 pt-3 border-t-2 border-black text-xl font-bold text-[#2f5d28]"><span>Total:</span> <span>${formatRupee(order.total)}</span></div>
                        </div>
                    </div>
                    <div class="text-center mt-12 no-print flex justify-center gap-4">
                        <button onclick="window.print()" class="bg-[#2f5d28] text-white px-8 py-3 rounded font-bold hover:bg-green-900 transition shadow-lg"><i class="fa-solid fa-print"></i> Print Invoice</button>
                        <button onclick="location.reload()" class="bg-gray-600 text-white px-8 py-3 rounded font-bold hover:bg-gray-700 transition shadow-lg">Close</button>
                    </div>
                </div>
            `;
            document.getElementById('app').innerHTML = invoiceHTML;
            window.scrollTo(0,0);
        }

        // --- ADMIN & LOGISTICS ---
        function updateOrderStatus(orderId) {
            const courier = document.getElementById(`courier-${orderId}`).value;
            const order = orders.find(o => o.id === orderId);
            if(order) {
                order.courier = courier;
                order.status = "Shipped";
                order.trackingId = "TRK" + Math.floor(Math.random() * 10000000);
                saveOrders();
                showToast(`Shipped via ${courier}`, 'success');
                router('admin');
            }
        }

        function deliverOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if(order) {
                order.status = "Delivered";
                saveOrders();
                showToast(`Order ${orderId} Marked Delivered`, 'success');
                router('admin');
            }
        }

        function handleProductFormSubmit(e) {
            e.preventDefault();
            const name = document.getElementById('prod-name').value;
            const price = parseFloat(document.getElementById('prod-price').value);
            const category = document.getElementById('prod-cat').value;
            const image = document.getElementById('prod-img').value;
            const desc = document.getElementById('prod-desc').value;
            if(!name || !price || !image) { alert("Fill all fields"); return; }
            if (editingProductId) {
                const index = products.findIndex(p => p.id === editingProductId);
                if (index !== -1) { products[index] = { id: editingProductId, name, price, category, image, description: desc }; showToast("Updated", 'success'); }
                cancelEdit();
            } else {
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                products.push({ id: newId, name, price, category, image, description: desc });
                showToast("Added", 'success');
                e.target.reset();
            }
            saveProducts();
            router('admin');
        }

        function startEditProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            editingProductId = id;
            document.getElementById('admin-form-card').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('form-title').innerText = "Edit Product";
            const btn = document.getElementById('form-submit-btn');
            btn.innerHTML = '<i class="fa-solid fa-save"></i> Update Product';
            btn.className = "w-full bg-brand-warning text-brand-dark font-bold py-2 rounded hover:bg-yellow-600 transition text-sm";
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            document.getElementById('prod-name').value = product.name;
            document.getElementById('prod-price').value = product.price;
            document.getElementById('prod-cat').value = product.category;
            document.getElementById('prod-img').value = product.image;
            document.getElementById('prod-desc').value = product.description;
        }

        function cancelEdit() {
            editingProductId = null;
            document.getElementById('form-title').innerText = "Add Product";
            const btn = document.getElementById('form-submit-btn');
            btn.innerHTML = '<i class="fa-solid fa-plus"></i> Add to Inventory';
            btn.className = "w-full bg-brand-success text-white font-bold py-2 rounded hover:bg-green-600 transition text-sm";
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            document.getElementById('admin-prod-form').reset();
        }

        function deleteProduct(id) {
            if(confirm("Delete this product?")) {
                products = products.filter(p => p.id != id);
                saveProducts();
                if (editingProductId == id) cancelEdit();
                router('admin');
                showToast("Deleted", 'danger');
            }
        }

        function trackOrder(e) {
            e.preventDefault();
            const id = document.getElementById('track-id').value;
            const order = orders.find(o => o.id === id);
            const resultDiv = document.getElementById('track-result');
            if(order) {
                renderOrderCard(order, resultDiv);
            } else {
                resultDiv.innerHTML = `<div class="bg-red-900/20 border border-red-500 text-red-400 p-4 rounded mt-6 text-center">Order ID not found.</div>`;
            }
        }

        function renderOrderCard(order, container) {
            let statusColor = 'text-yellow-400';
            if(order.status === 'Delivered') statusColor = 'text-green-400';
            if(order.status.includes('Return')) statusColor = 'text-orange-400';
            
            // 5-Day Return Check
            const eligible = checkReturnEligibility(order.date);
            
            let actionButton = '';
            if(order.status === 'Delivered') {
                if(eligible) {
                    actionButton = `<button onclick="requestReturn('${order.id}')" class="mt-4 w-full bg-red-600 text-white py-2 rounded font-bold hover:bg-red-700 transition"><i class="fa-solid fa-rotate-left"></i> Return Item</button>`;
                } else {
                    actionButton = `<div class="mt-4 text-center text-gray-400 font-bold border border-gray-600 p-2 rounded">Return Window Closed</div>`;
                }
            } else if (order.status === 'Return Requested') {
                actionButton = `<div class="mt-4 text-center text-orange-400 font-bold border border-orange-400 p-2 rounded">Return Requested: "${order.returnReason || 'N/A'}"</div>`;
            } else if (order.status === 'Returned') {
                actionButton = `<div class="mt-4 text-center text-red-400 font-bold border border-red-400 p-2 rounded">Returned & Refunded</div>`;
            }

            container.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mt-6 animate-pulse">
                    <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-white">Order Status</h3><span class="${statusColor} font-bold text-lg bg-gray-900 px-3 py-1 rounded border border-gray-600">${order.status}</span></div>
                    <div class="grid grid-cols-2 gap-4 text-sm text-gray-300 mb-6"><div><p class="text-gray-500">Amount</p><p class="text-white font-bold">${formatRupee(order.total)}</p></div><div><p class="text-gray-500">Order ID</p><p class="text-white font-bold">${order.id}</p></div><div><p class="text-gray-500">Tracking</p><p class="text-brand-accent font-mono">${order.trackingId}</p></div><div><p class="text-gray-500">Date</p><p class="text-white">${order.date}</p></div></div>
                    <div class="border-t border-gray-700 pt-6"><div class="timeline-item active"><h4 class="text-white font-bold">Placed</h4><p class="text-xs text-gray-500">${order.date}</p></div><div class="timeline-item ${order.status !== 'Processing' ? 'active' : ''}"><h4 class="text-white font-bold">Dispatched</h4></div><div class="timeline-item ${order.status === 'Delivered' || order.status.includes('Return') ? 'active' : ''} border-none"><h4 class="text-white font-bold">Delivered</h4></div></div>
                    <div class="mt-6 pt-4 border-t border-gray-700"><button onclick="generateInvoice('${order.id}')" class="w-full bg-brand-primary text-white py-2 rounded font-bold hover:bg-blue-600 transition mb-2"><i class="fa-solid fa-file-invoice"></i> Download Invoice</button>${actionButton}</div>
                </div>`;
        }

        // --- ROUTER ---
        function router(page, param = null) {
            const app = document.getElementById('app');
            window.scrollTo(0,0);
            if (page === 'home') renderHome(app);
            else if (page === 'product') renderProductDetail(app, param);
            else if (page === 'cart') renderCartPage(app);
            else if (page === 'login') renderLoginPage(app);
            else if (page === 'signup') renderSignupPage(app);
            else if (page === 'track') renderTrackingPage(app);
            else if (page === 'checkout') renderCheckoutPage(app);
            else if (page === 'my-orders') renderMyOrdersPage(app);
            else if (page === 'admin') {
                if(currentUser && currentUser.isAdmin) renderAdminPanel(app);
                else { showToast("Restricted", 'danger'); router('login'); }
            }
        }

        // --- RENDERERS ---
        function renderHome(container) {
            container.innerHTML = `
                <div class="tech-gradient rounded-2xl p-8 md:p-12 mb-10 text-center md:text-left shadow-lg relative overflow-hidden">
                    <div class="relative z-10"><h2 class="text-4xl md:text-5xl font-tech font-bold text-white mb-4">BUILD THE FUTURE</h2><p class="text-blue-900 font-bold text-lg mb-6 max-w-xl">India's favorite store for makers. Official Arduino & Espressif distributors.</p><button onclick="document.getElementById('products-grid').scrollIntoView({behavior: 'smooth'})" class="bg-brand-dark text-white px-8 py-3 rounded-full font-bold hover:bg-white hover:text-brand-dark transition border-2 border-brand-dark">Shop Now</button></div>
                </div>
                <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    ${products.map(p => `<div class="bg-brand-surface border border-gray-700 rounded-xl overflow-hidden card-hover flex flex-col"><div class="h-48 bg-white p-4 flex items-center justify-center cursor-pointer" onclick="router('product', ${p.id})"><img src="${p.image}" alt="${p.name}" class="max-h-full max-w-full object-contain"></div><div class="p-4 flex-grow flex flex-col"><span class="text-xs text-brand-accent uppercase tracking-wide mb-1">${p.category}</span><h3 class="font-bold text-lg text-white mb-2 truncate cursor-pointer" onclick="router('product', ${p.id})">${p.name}</h3><div class="mt-auto flex justify-between items-center"><span class="text-xl font-bold text-brand-primary">${formatRupee(p.price)}</span><button onclick="addToCart(${p.id})" class="bg-brand-primary text-white p-2 rounded-lg hover:bg-blue-600 transition"><i class="fa-solid fa-cart-plus"></i> Add</button></div></div></div>`).join('')}
                </div>`;
        }
        
        function filterCategory(cat) {
            const grid = document.getElementById('products-grid');
            if(!grid) { router('home'); return; }
            const filtered = cat === 'all' ? products : products.filter(p => p.category === cat);
            grid.innerHTML = filtered.map(p => `<div class="bg-brand-surface border border-gray-700 rounded-xl overflow-hidden card-hover flex flex-col"><div class="h-48 bg-white p-4 flex items-center justify-center cursor-pointer" onclick="router('product', ${p.id})"><img src="${p.image}" alt="${p.name}" class="max-h-full max-w-full object-contain"></div><div class="p-4 flex-grow flex flex-col"><span class="text-xs text-brand-accent uppercase tracking-wide mb-1">${p.category}</span><h3 class="font-bold text-lg text-white mb-2 truncate cursor-pointer" onclick="router('product', ${p.id})">${p.name}</h3><div class="mt-auto flex justify-between items-center"><span class="text-xl font-bold text-brand-primary">${formatRupee(p.price)}</span><button onclick="addToCart(${p.id})" class="bg-brand-primary text-white p-2 rounded-lg hover:bg-blue-600 transition"><i class="fa-solid fa-cart-plus"></i> Add</button></div></div></div>`).join('');
        }

        function renderTrackingPage(container) {
            container.innerHTML = `
                <div class="max-w-2xl mx-auto py-10">
                    <h2 class="text-3xl font-tech text-white text-center mb-8">Track Your Order</h2>
                    <div class="bg-brand-surface p-8 rounded-2xl border border-gray-700 shadow-xl">
                        <form id="track-form" onsubmit="trackOrder(event)" class="flex gap-4">
                            <input type="text" id="track-id" placeholder="Enter Order ID (e.g., ORD-9001)" class="flex-grow bg-gray-800 border border-gray-600 rounded-lg p-3 text-white focus:border-brand-primary outline-none">
                            <button type="submit" class="bg-brand-primary text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-600 transition">Track</button>
                        </form>
                        <div id="track-result"></div>
                    </div>
                </div>`;
        }

        function renderMyOrdersPage(container) {
            if (!currentUser) { router('login'); return; }
            // Filter orders for this user
            const myOrders = orders.filter(o => o.email === currentUser.email);
            
            container.innerHTML = `
                <div class="max-w-4xl mx-auto py-10">
                    <h2 class="text-3xl font-tech text-white mb-8">My Orders</h2>
                    ${myOrders.length === 0 ? '<p class="text-gray-400">No orders found.</p>' : ''}
                    <div class="space-y-6">
                        ${myOrders.map(order => {
                            // Logic to determine return button visibility
                            const eligible = checkReturnEligibility(order.date);
                            let action = '';
                            if(order.status === 'Delivered') {
                                if(eligible) action = `<button onclick="requestReturn('${order.id}')" class="text-xs bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 ml-4">Return</button>`;
                                else action = `<span class="text-xs text-gray-500 ml-4">Return Window Closed</span>`;
                            } else if (order.status === 'Return Requested') {
                                action = `<span class="text-xs text-orange-400 ml-4">Return Pending</span>`;
                            }

                            return `
                            <div class="bg-brand-surface border border-gray-700 rounded-xl p-6 flex flex-col md:flex-row justify-between items-center">
                                <div>
                                    <div class="flex items-center gap-3">
                                        <span class="font-bold text-white text-lg">${order.id}</span>
                                        <span class="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded">${order.date}</span>
                                    </div>
                                    <p class="text-sm text-gray-400 mt-1">${order.items.length} items • Total: ${formatRupee(order.total)}</p>
                                </div>
                                <div class="flex items-center mt-4 md:mt-0">
                                    <span class="font-bold text-${order.status==='Delivered'?'green':(order.status==='Returned'?'red':'blue')}-400">${order.status}</span>
                                    ${action}
                                    <button onclick="generateInvoice('${order.id}')" class="ml-4 text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700"><i class="fa-solid fa-download"></i> Invoice</button>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderCheckoutPage(container) {
            const subTotal = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
            const shipping = subTotal >= FREE_SHIPPING_THRESHOLD ? 0 : SHIPPING_FEE;
            const total = subTotal + shipping;
            const user = currentUser || {};
            
            container.innerHTML = `
                <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-6">Secure Checkout</h2>
                        <form onsubmit="handleCheckout(event)" class="space-y-4">
                            <input type="text" id="checkout-name" value="${user.name || ''}" placeholder="Full Name" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
                            <input type="email" id="checkout-email" value="${user.email || ''}" placeholder="Email" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
                            <input type="tel" id="checkout-phone" placeholder="Phone Number" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" id="checkout-city" placeholder="City" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
                                <input type="text" placeholder="Pincode" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white">
                            </div>
                            <textarea id="checkout-address" placeholder="Address" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white"></textarea>
                            <button type="submit" class="w-full bg-brand-primary text-white font-bold py-3 rounded mt-4">Pay ${formatRupee(total)}</button>
                        </form>
                    </div>
                    <div class="bg-brand-surface border border-gray-700 rounded-xl p-6 h-fit">
                        <h3 class="font-bold text-white mb-4">Order Summary</h3>
                        ${cart.map(i => `<div class="flex justify-between text-sm mb-2 text-gray-300"><span>${i.name} x${i.qty}</span><span>${formatRupee(i.price*i.qty)}</span></div>`).join('')}
                        <div class="border-t border-gray-600 pt-2 mt-2">
                            <div class="flex justify-between text-sm text-gray-400 mb-1"><span>Subtotal</span><span>${formatRupee(subTotal)}</span></div>
                            <div class="flex justify-between text-sm text-gray-400 mb-2"><span>Shipping</span><span class="${shipping===0?'text-green-400':''}">${shipping===0 ? 'FREE' : formatRupee(shipping)}</span></div>
                            <div class="flex justify-between font-bold text-white text-lg border-t border-gray-600 pt-2"><span>Total</span><span>${formatRupee(total)}</span></div>
                        </div>
                    </div>
                </div>`;
        }

        function renderAdminPanel(container) {
            const totalRevenue = orders.reduce((acc, o) => acc + o.total, 0);
            const returnRequests = orders.filter(o => o.status === 'Return Requested').length;
            const returnBadge = returnRequests > 0 ? `<span class="bg-red-600 text-white text-xs px-2 py-1 rounded-full animate-pulse ml-2">${returnRequests} New Returns</span>` : '';

            container.innerHTML = `
                <div class="max-w-7xl mx-auto">
                    <div class="flex justify-between items-center mb-8 border-b border-gray-700 pb-4">
                        <div><h2 class="text-3xl font-tech font-bold text-white">Namaste, Admin</h2><p class="text-gray-400 text-sm">Logistics & Inventory Control ${returnBadge}</p></div>
                        <div class="text-right text-brand-accent font-bold">${new Date().toLocaleDateString('en-IN')}</div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="dash-card bg-green-900/30 border-green-800"><p class="text-green-300 text-sm font-bold uppercase">Revenue</p><h3 class="text-3xl text-white font-bold mt-1 indian-rupee">${formatRupee(totalRevenue)}</h3></div>
                        <div class="dash-card bg-blue-900/30 border-blue-800"><p class="text-blue-300 text-sm font-bold uppercase">Orders</p><h3 class="text-3xl text-white font-bold mt-1">${orders.length}</h3></div>
                        <div class="dash-card bg-purple-900/30 border-purple-800"><p class="text-purple-300 text-sm font-bold uppercase">Inventory</p><h3 class="text-3xl text-white font-bold mt-1">${products.length}</h3></div>
                    </div>

                    <div class="mb-8 p-4 bg-gray-800 border border-gray-700 rounded-xl">
                        <h3 class="text-xl font-bold text-white mb-4"><i class="fa-solid fa-user-shield text-brand-danger"></i> Security Settings</h3>
                        <form onsubmit="updateAdminSettings(event)" class="flex flex-col md:flex-row gap-4 items-end">
                            <div class="flex-1 w-full"><label class="text-xs text-gray-400">New Email ID</label><input type="email" id="admin-new-email" value="${adminCreds.email}" required class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white"></div>
                            <div class="flex-1 w-full"><label class="text-xs text-gray-400">Current Password</label><input type="password" id="admin-curr-pass" required placeholder="Enter current password" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white"></div>
                            <div class="flex-1 w-full"><label class="text-xs text-gray-400">New Password</label><input type="password" id="admin-new-pass" required placeholder="Enter new password" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white"></div>
                            <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold w-full md:w-auto">Update Credentials</button>
                        </form>
                    </div>

                    <div class="mb-8">
                         <h3 class="text-xl font-bold text-white mb-4"><i class="fa-solid fa-truck-fast text-brand-accent"></i> Logistics Management</h3>
                         <div class="bg-brand-surface border border-gray-700 rounded-xl overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-gray-700 text-gray-300"><tr><th class="p-3">Order ID</th><th class="p-3">Customer</th><th class="p-3">City</th><th class="p-3">Status</th><th class="p-3">Assign Partner</th><th class="p-3">Action</th></tr></thead>
                                    <tbody class="text-gray-300">
                                        ${orders.map(o => `
                                            <tr class="border-b border-gray-700 hover:bg-gray-800">
                                                <td class="p-3 font-mono text-brand-accent">${o.id}</td><td class="p-3">${o.customer}</td><td class="p-3">${o.city}</td>
                                                <td class="p-3"><span class="px-2 py-1 rounded text-xs ${o.status.includes('Return') ? 'bg-orange-900 text-orange-300' : (o.status === 'Delivered' ? 'bg-green-900 text-green-300' : 'bg-blue-900 text-blue-300')}">${o.status}</span></td>
                                                <td class="p-3">${o.status === 'Processing' ? `<select id="courier-${o.id}" class="bg-gray-900 border border-gray-600 rounded p-1 text-xs text-white"><option value="Delhivery">Delhivery</option><option value="BlueDart">BlueDart</option></select>` : `<span class="text-gray-500 text-xs">${o.courier}</span>`}</td>
                                                <td class="p-3">${o.status === 'Processing' ? `<button onclick="updateOrderStatus('${o.id}')" class="bg-brand-primary text-white px-2 py-1 rounded text-xs">Dispatch</button>` : 
                                                  (o.status === 'Shipped' ? `<button onclick="deliverOrder('${o.id}')" class="bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700">Mark Delivered</button>` :
                                                  (o.status === 'Return Requested' ? `<div class="flex gap-2"><button onclick="approveReturn('${o.id}')" class="bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700">Approve</button><button onclick="rejectReturn('${o.id}')" class="bg-red-600 text-white px-2 py-1 rounded text-xs hover:bg-red-700">Reject</button></div><div class="text-[10px] text-orange-300 mt-1">Reason: ${o.returnReason}</div>` : `<span class="text-gray-500 text-xs">-</span>`))}</td>
                                            </tr>`).join('')}
                                    </tbody>
                                </table>
                            </div>
                         </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <div id="admin-form-card" class="lg:col-span-1 dash-card relative">
                            <div class="flex justify-between items-center mb-4"><h3 id="form-title" class="text-xl font-bold text-white">Add Product</h3><button id="cancel-edit-btn" onclick="cancelEdit()" class="hidden text-xs text-red-400 hover:text-white bg-red-900/50 px-2 py-1 rounded">Cancel Edit</button></div>
                            <form id="admin-prod-form" onsubmit="handleProductFormSubmit(event)" class="space-y-3"><input type="text" id="prod-name" placeholder="Product Name" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-sm"><div class="grid grid-cols-2 gap-2"><input type="number" id="prod-price" placeholder="Price (₹)" required step="0.01" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-sm"><select id="prod-cat" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-sm"><option value="microcontrollers">Micro</option><option value="components">Comp</option><option value="sensors">Sensor</option><option value="motors">Motor</option></select></div><input type="url" id="prod-img" placeholder="Image URL" required class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-sm"><textarea id="prod-desc" placeholder="Description" rows="2" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-sm"></textarea><button type="submit" id="form-submit-btn" class="w-full bg-brand-success text-white font-bold py-2 rounded hover:bg-green-600 transition text-sm"><i class="fa-solid fa-plus"></i> Add to Inventory</button></form>
                        </div>
                        <div class="lg:col-span-2 bg-brand-surface border border-gray-700 rounded-xl overflow-hidden">
                            <div class="p-4 bg-gray-800 border-b border-gray-700"><h3 class="font-bold text-white">Stock Overview</h3></div>
                            <div class="overflow-x-auto max-h-96 overflow-y-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-gray-700 text-gray-300"><tr><th class="p-3">Name</th><th class="p-3">Price</th><th class="p-3">Actions</th></tr></thead>
                                    <tbody class="text-gray-300">${products.map(p => `<tr class="border-b border-gray-700 hover:bg-gray-800"><td class="p-3 flex items-center gap-2"><img src="${p.image}" class="w-8 h-8 rounded bg-white object-contain"><span class="truncate max-w-[150px]">${p.name}</span></td><td class="p-3">${formatRupee(p.price)}</td><td class="p-3 flex gap-2"><button onclick="startEditProduct(${p.id})" class="text-blue-400 hover:text-blue-300 border border-blue-900 bg-blue-900/20 px-2 py-1 rounded"><i class="fa-solid fa-pen-to-square"></i></button><button onclick="deleteProduct(${p.id})" class="text-red-400 hover:text-red-300 border border-red-900 bg-red-900/20 px-2 py-1 rounded"><i class="fa-solid fa-trash"></i></button></td></tr>`).join('')}</tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        function renderLoginPage(container) { container.innerHTML = `<div class="max-w-md mx-auto bg-brand-surface border border-gray-700 rounded-2xl p-8 shadow-2xl mt-10"><h2 class="text-3xl font-tech text-white text-center mb-6">Login</h2><form onsubmit="handleLogin(event)" class="space-y-4"><input type="email" id="login-email" placeholder="Email" required class="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white"><input type="password" id="login-pass" placeholder="Password" required class="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white"><button class="w-full bg-brand-primary text-white font-bold py-3 rounded">LOGIN</button></form><p class="text-center text-gray-400 mt-6 text-sm">New here? <span class="text-brand-accent cursor-pointer hover:underline" onclick="router('signup')">Sign Up</span></p></div>`; }
        function renderSignupPage(container) { container.innerHTML = `<div class="max-w-md mx-auto bg-brand-surface border border-gray-700 rounded-2xl p-8 shadow-2xl mt-10"><h2 class="text-3xl font-tech text-white text-center mb-6">Sign Up</h2><form onsubmit="handleSignup(event)" class="space-y-4"><input type="text" id="signup-name" placeholder="Name" required class="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white"><input type="email" id="signup-email" placeholder="Email" required class="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white"><input type="password" id="signup-pass" placeholder="Password" required class="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white"><button class="w-full bg-brand-primary text-white font-bold py-3 rounded">Create Account</button></form></div>`; }
        function renderProductDetail(container, id) { const product = products.find(p => p.id === id); container.innerHTML = `<div class="max-w-4xl mx-auto"><button onclick="router('home')" class="mb-4 text-gray-400 hover:text-white flex items-center gap-2"><i class="fa-solid fa-arrow-left"></i> Back</button><div class="bg-brand-surface border border-gray-700 rounded-2xl overflow-hidden shadow-xl flex flex-col md:flex-row"><div class="md:w-1/2 bg-white p-8 flex items-center justify-center"><img src="${product.image}" class="max-w-full max-h-80 object-contain"></div><div class="md:w-1/2 p-8 flex flex-col justify-center"><span class="text-brand-accent uppercase text-sm font-bold mb-2">${product.category}</span><h1 class="text-3xl font-bold text-white mb-4">${product.name}</h1><div class="text-3xl text-brand-primary font-bold mb-6">${formatRupee(product.price)}</div><p class="text-gray-300 mb-8">${product.description}</p><button onclick="addToCart(${product.id})" class="w-full bg-brand-primary text-white font-bold py-4 rounded-lg hover:opacity-90 transition">ADD TO CART</button></div></div></div>`; }
        function renderCartPage(container) { 
            const subTotal = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
            const shipping = subTotal >= FREE_SHIPPING_THRESHOLD ? 0 : SHIPPING_FEE;
            const total = subTotal + shipping;
            if(cart.length === 0) { container.innerHTML = `<div class="text-center py-20 text-gray-400"><h2 class="text-2xl font-bold">Cart is Empty</h2><button onclick="router('home')" class="bg-brand-primary px-6 py-2 rounded mt-4 text-white">Shop Now</button></div>`; return; }
            container.innerHTML = `<div class="max-w-4xl mx-auto"><h2 class="text-2xl font-bold text-white mb-6">Shopping Cart</h2><div class="bg-brand-surface border border-gray-700 rounded-xl mb-6">${cart.map(item => `<div class="flex items-center border-b border-gray-700 p-4"><img src="${item.image}" class="w-16 h-16 bg-white rounded object-contain"><div class="ml-4 flex-grow"><h3 class="font-bold text-white">${item.name}</h3><p class="text-gray-400">${formatRupee(item.price)}</p></div><div class="flex items-center gap-2"><button onclick="updateQty(${item.id}, -1)" class="w-6 h-6 bg-gray-700 text-white rounded">-</button><span class="text-white font-bold">${item.qty}</span><button onclick="updateQty(${item.id}, 1)" class="w-6 h-6 bg-gray-700 text-white rounded">+</button></div><button onclick="removeFromCart(${item.id})" class="ml-4 text-red-400"><i class="fa-solid fa-trash"></i></button></div>`).join('')}</div><div class="flex justify-between items-center bg-brand-surface border border-gray-700 p-6 rounded-xl"><div class="text-right w-full"><div class="text-gray-400 text-sm mb-1">Subtotal: ${formatRupee(subTotal)}</div><div class="text-gray-400 text-sm mb-2">Shipping: ${shipping===0?'FREE':formatRupee(shipping)}</div><div class="text-xl font-bold text-white mb-4">Total: <span class="text-brand-accent">${formatRupee(total)}</span></div><button onclick="router('checkout')" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded">Checkout</button></div></div></div>`;
        }

        window.onload = () => { updateCartCount(); updateAuthUI(); router('home'); };
    </script>
</body>
</html>